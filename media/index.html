<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>WebSocket Test</title>
</head>
<body>
<h2>Connection Status</h2>
<p id="status-container">waiting...</p>
<h2>Submit JWT</h2>
<label for="jwt">JWT</label>
<input type="text" id="jwt-input">
<button id="jwt-button">submit</button>
<h2>Message received</h2>
<div id="message-container">
</div>
<script>
const uri = (window.location.protocol === 'https:' && 'wss://' || 'ws://') + window.location.host + '/api/v1/ws';
const connection = new WebSocket(uri);
const statusContainer = document.getElementById('status-container');
connection.onopen = () => {
    console.log('connected!');
    statusContainer.innerText = 'connected'
};
connection.onclose = () => {
    console.log('disconnected!');
    statusContainer.innerText = 'disconnected'
};
connection.onerror = e => {
    console.error('error:');
    console.error(e);
};
const messageContainer = document.getElementById('message-container');
connection.onmessage = e => {
    const p = document.createElement("p");
    p.innerText = e.data;
    messageContainer.appendChild(p);
};
const jwtInput = document.getElementById('jwt-input');
const jwtButton = document.getElementById('jwt-button');
jwtButton.addEventListener('click', () => {
    if (connection.readyState === connection.OPEN) {
        connection.send(JSON.stringify({
            requestId: 0,
            message: {
                type: 'update-token',
                jwt: jwtInput.value || null,
            }
        }))
    }
})
</script>
</body>
</html>